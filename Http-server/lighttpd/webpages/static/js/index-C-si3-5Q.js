var Ce=Object.defineProperty,Me=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var se=(c,r,d)=>r in c?Ce(c,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[r]=d,W=(c,r)=>{for(var d in r||(r={}))$e.call(r,d)&&se(c,d,r[d]);if(ne)for(var d of ne(r))Ye.call(r,d)&&se(c,d,r[d]);return c},G=(c,r)=>Me(c,Te(r));var B=(c,r,d)=>new Promise((L,M)=>{var z=t=>{try{T(d.next(t))}catch(a){M(a)}},q=t=>{try{T(d.throw(t))}catch(a){M(a)}},T=t=>t.done?L(t.value):Promise.resolve(t.value).then(z,q);T((d=d.apply(c,r)).next())});import{h as J,d as Ie,r as D,l as oe,am as N,c as C,I as Be,G as ze,a as w,L as qe,o as g,q as Z,w as m,M as Ue,b as x,n as re,u as s,t as o,y as ue,e as i,f as u,F as P,i as j,g as h,z as Ee,aN as k,aL as ee,aM as Ne,_ as Pe}from"./index-BSlF4gO8.js";import{s as je}from"./strategy-CdfYy6eX.js";import Le from"./index-SdbVY182.js";import Oe from"./TimeStep-y7Yn-9nu.js";import{A as H,P as ie,S as Ae}from"./utils-CABZ3EnZ.js";const Fe=()=>J.request("get","/lcmain?type=strategyManagement"),Re=c=>J.request("post","/lcmain/addStrategyManagement",{data:c}),We=c=>J.request("post","/lcmain/updateStrategyManagement",{data:c}),Ge=c=>J.request("post","/lcmain/deleteStrategyManagement",{data:c}),He={class:"calendar m-[24px]"},Je={class:"strategy"},Ke={class:"flex"},Qe=["onClick"],Xe={key:0},Ze={class:"content"},et={class:"content-item"},tt={style:{"margin-right":"40px"}},at={style:{"margin-right":"40px"}},lt={class:"content-item"},nt={style:{"margin-right":"100px"}},st={class:"content-item justify-center"},ot={class:"content-item"},rt={style:{width:"35%"}},ut={class:"content-item justify-center mt-[20px]"},it={class:"el-calendar__title"},dt=["onClick"],mt=["title"],ct={key:1},pt={class:"right w-[250px] ml-[10px] bg-white"},gt={class:"header"},vt={key:0,class:"mx-[15px]"},yt={class:"title"},_t={class:"strategy"},ft={class:"plan"},ht=Ie({name:"StratedyManagement",__name:"index",setup(c){const r=D(!1),d=D("first"),L=D(new Date),M=D(),z=n=>{M.value&&M.value.selectDate(n)},{t:q}=oe(),{locale:T,t}=oe(),a=D({name:"",repeat:2,priority:null,start_time:"",end_time:"",type:[],template_uuid:""});let U=N(a.value);const v=D([{id:"",sort:0,name:""},{id:"",sort:1,name:""},{id:"",sort:2,name:""},{id:"",sort:3,name:""},{id:"",sort:4,name:""}]),y=D(0),de=C(()=>`${160*(y.value+1)-68}px`),K=n=>{Object.keys(a.value).forEach(_=>{var f;_==="type"&&(n.type=(((f=n.weekly)==null?void 0:f.split(","))||[]).map(Number)),a.value[_]=n[_]})},Q=(n,e)=>{y.value=e,n.id?K(n):a.value={name:"",repeat:2,priority:null,start_time:"",end_time:"",type:[],template_uuid:""},U=N(a.value)},me=(n,e)=>{Ne(a.value,U)?Q(n,e):ee.confirm(t("strategy.management.dataChange"),"",{confirmButtonText:t("strategy.management.ok"),cancelButtonText:t("strategy.management.cancel")}).then(()=>{Q(n,e)}).catch(()=>{})},O=D([]),$=C(()=>O.value.find(e=>String(e.uuid)===String(a.value.template_uuid))),te=C(()=>{var n;return((n=$.value)==null?void 0:n.basic_parameters.map(e=>G(W({},e),{startIndex:H.indexOf(e.start_time),endIndex:H.indexOf(e.end_time),power:e.planned_power,color:ie[e.control_type]})))||[]}),ce=C(()=>n=>t(`common.${n===1?"charge":n===2?"discharge":n===3?"standby":"shutdown"}`)),X=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],pe=[1,2,3,4,5],ge=C(()=>n=>{for(let e=0;e<v.value.length;e+=1)if(e!==y.value&&v.value[e].sort===n)return!0;return!1}),ae=(n,e=0)=>{let _=!1,f=!0,R=!0,S=!0;const Y=new Date(n).getTime();if(a.value.start_time){const V=new Date(a.value.start_time).getTime();_=!0,f=Y>=V}if(a.value.end_time){const V=new Date(a.value.end_time).getTime();_=!0,R=Y<=V}return e&&a.value.repeat===3&&(S=a.value.type.findIndex(V=>V===A.value.week)!==-1),_&&f&&R&&S},ve=C(()=>n=>a.value.repeat===1||ae(n)),ye=C(()=>a.value.repeat===1||ae(A.value.day,1)),A=D({day:Be(new Date).format("YYYY-MM-DD"),week:X.findIndex(n=>n===String(new Date).split(" ")[0])+1}),_e=n=>{A.value.day=n.day,A.value.week=X.findIndex(e=>e===String(n.date).split(" ")[0])+1},fe=()=>B(this,null,function*(){r.value=!0,yield F(),Q(v.value[y.value],y.value),r.value=!1}),he=()=>{if(!a.value.name){k(t("strategy.management.inputStrategyName"),{type:"warning"});return}if(!a.value.template_uuid){k(t("strategy.management.selectStrategyTemplate"),{type:"warning"});return}if(!a.value.repeat){k(t("strategy.management.selectRepeat"),{type:"warning"});return}if(!a.value.priority){k(t("strategy.management.selectPriority"),{type:"warning"});return}if(a.value.repeat!==1){if(!a.value.start_time){k(t("strategy.management.selectStartDate"),{type:"warning"});return}if(!a.value.end_time){k(t("strategy.management.selectEndDate"),{type:"warning"});return}}ee.confirm(t("strategy.management.addStrategy"),"",{confirmButtonText:t("strategy.management.ok"),cancelButtonText:t("strategy.management.cancel")}).then(()=>B(this,null,function*(){r.value=!0;const{id:n}=v.value[y.value];let e={};n?e=yield We(G(W({id:n,sort:v.value[y.value].sort},a.value),{weekly:a.value.type.join(","),template_name:"",energy_storage_subsystem:""})):e=yield Re(G(W({sort:v.value[y.value].sort},a.value),{weekly:a.value.type.join(","),template_name:"",energy_storage_subsystem:""})),e.code===200?(k(t(`request.${n?"update":"add"}Success`),{type:"success"}),yield F(),v.value[y.value].id&&(K(v.value[y.value]),U=N(a.value))):k(t(`request.${n?"update":"add"}Fail`),{type:"error"}),r.value=!1})).catch(()=>{})},be=()=>{if(!v.value[y.value].id){k(t("strategy.management.selectExistStrategy"),{type:"warning"});return}ee.confirm(t("strategy.management.deleteStrategy"),"",{confirmButtonText:t("strategy.management.ok"),cancelButtonText:t("strategy.management.cancel")}).then(()=>B(this,null,function*(){r.value=!0,(yield Ge({id:v.value[y.value].id})).code===200?(k(t("request.deleteSuccess"),{type:"success"}),yield F(),v.value[y.value]={id:"",sort:y.value,name:""},a.value={name:"",repeat:2,priority:null,start_time:"",end_time:"",type:[],template_uuid:""},U=N(a.value)):k(t("request.deleteFail"),{type:"error"}),r.value=!1})).catch(()=>{})},F=()=>B(this,null,function*(){const n=yield Fe();n.code===200&&(n.data.strategyManagement||[]).forEach(_=>{v.value[_.sort]=_})});return ze(()=>B(this,null,function*(){var e;r.value=!0;const n=yield je();n.code===200&&(O.value=((e=n.data)==null?void 0:e.strategy)||[],O.value.forEach(_=>{_.basic_parameters.forEach(f=>{f.startIndex=H.indexOf(f.start_time),f.endIndex=H.indexOf(f.end_time),f.color=ie[f.control_type]})})),yield F(),v.value[0].id&&(K(v.value[0]),U=N(a.value)),r.value=!1})),(n,e)=>{const _=w("Plus"),f=w("el-icon"),R=w("el-input"),S=w("el-option"),Y=w("el-select"),V=w("el-date-picker"),we=w("el-checkbox"),xe=w("el-checkbox-group"),I=w("el-button"),le=w("el-tab-pane"),ke=w("el-button-group"),De=w("el-calendar"),Se=w("el-tabs"),Ve=qe("load");return g(),Z(Le,{"active-name":"management"},{default:m(()=>[Ue((g(),x("div",He,[d.value==="second"?(g(),x("div",{key:0,class:re(["tip",{zhTip:s(T)==="zh"}])},o(s(t)("strategy.management.planAndContent")),3)):ue("",!0),i(Se,{modelValue:d.value,"onUpdate:modelValue":e[14]||(e[14]=l=>d.value=l)},{default:m(()=>[i(le,{label:s(t)("strategy.management.strategy"),name:"first"},{default:m(()=>[u("div",Je,[u("div",Ke,[(g(!0),x(P,null,j(v.value,(l,b)=>(g(),x("div",{key:`${l.id}-${b}`,class:re(["title",{active:b===y.value}]),onClick:p=>me(l,b)},[l.id?(g(),x("div",Xe,o(l.name),1)):(g(),Z(f,{key:1,size:24},{default:m(()=>[i(_)]),_:1}))],10,Qe))),128))]),u("div",Ze,[u("div",et,[u("span",tt,[h(o(s(t)("strategy.management.name")),1),i(R,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.name=l),maxlength:8,style:{width:"200px","margin-right":"10px"}},null,8,["modelValue"]),h(o(s(t)("strategy.management.maxChars")),1)]),u("span",at,[h(o(s(t)("strategy.management.executeDuration"))+" ",1),i(Y,{modelValue:a.value.repeat,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.repeat=l),placeholder:s(t)("strategy.management.pleaseSelect")},{default:m(()=>[i(S,{label:s(t)("strategy.management.longTime"),value:1},null,8,["label"]),i(S,{label:s(t)("strategy.management.everyDay"),value:2},null,8,["label"]),i(S,{label:s(t)("strategy.management.everyWeek"),value:3},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),u("span",null,[h(o(s(t)("strategy.management.priority"))+" ",1),i(Y,{modelValue:a.value.priority,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.priority=l),clearable:"",placeholder:s(t)("strategy.management.pleaseSelect")},{default:m(()=>[(g(),x(P,null,j(pe,(l,b)=>i(S,{key:`${l}-${b}`,label:l,value:l,disabled:ge.value(l)},null,8,["label","value","disabled"])),64))]),_:1},8,["modelValue","placeholder"])])]),u("div",lt,[u("span",nt,[h(o(s(t)("strategy.management.startDate"))+" ",1),i(V,{modelValue:a.value.start_time,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.start_time=l),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:s(t)("strategy.management.pleaseSelectDate"),disabled:a.value.repeat===1,"disabled-date":l=>l.getTime()>new Date(a.value.end_time).getTime()},null,8,["modelValue","placeholder","disabled","disabled-date"])]),u("span",null,[h(o(s(t)("strategy.management.endDate"))+" ",1),i(V,{modelValue:a.value.end_time,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.end_time=l),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:s(t)("strategy.management.pleaseSelectDate"),disabled:a.value.repeat===1,"disabled-date":l=>l.getTime()<new Date(a.value.start_time).getTime()},null,8,["modelValue","placeholder","disabled","disabled-date"])])]),u("div",st,[i(xe,{modelValue:a.value.type,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.type=l),disabled:a.value.repeat===1||a.value.repeat===2},{default:m(()=>[(g(),x(P,null,j(X,(l,b)=>i(we,{key:`${l}-${b}`,label:b+1,name:"type",style:{width:"80px"}},{default:m(()=>[h(o(s(t)(`strategy.management.${l}`)),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue","disabled"])]),u("div",ot,[u("span",rt,[h(o(s(t)("strategy.management.template"))+" ",1),i(Y,{modelValue:a.value.template_uuid,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.template_uuid=l),placeholder:s(t)("strategy.management.pleaseSelect")},{default:m(()=>[(g(!0),x(P,null,j(O.value,(l,b)=>(g(),Z(S,{key:`${l.uuid}-${b}`,label:l.template_name,value:l.uuid},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])])]),u("div",ut,[i(I,{loading:r.value,icon:"Refresh",onMousedown:e[7]||(e[7]=l=>l.preventDefault()),onClick:fe},{default:m(()=>[h(o(s(t)("strategy.management.refresh")),1)]),_:1},8,["loading"]),i(I,{loading:r.value,icon:"Document",onMousedown:e[8]||(e[8]=l=>l.preventDefault()),onClick:he},{default:m(()=>[h(o(s(t)("strategy.management.save")),1)]),_:1},8,["loading"]),i(I,{loading:r.value,icon:"Delete",onMousedown:e[9]||(e[9]=l=>l.preventDefault()),onClick:be},{default:m(()=>[h(o(s(t)("strategy.management.delete")),1)]),_:1},8,["loading"])]),u("div",{class:"triangle",style:Ee({left:de.value})},null,4)])])]),_:1},8,["label"]),i(le,{label:s(t)("strategy.management.preview"),name:"second",class:"flex"},{default:m(()=>{var l,b;return[i(De,{ref_key:"calendar",ref:M,modelValue:L.value,"onUpdate:modelValue":e[13]||(e[13]=p=>L.value=p),class:"flex-1"},{header:m(({date:p})=>[i(ke,null,{default:m(()=>[i(I,{size:"small",onClick:e[10]||(e[10]=E=>z("prev-month"))},{default:m(()=>[h(o(s(t)("strategy.management.previousMonth")),1)]),_:1}),i(I,{size:"small",onClick:e[11]||(e[11]=E=>z("today"))},{default:m(()=>[h(o(s(t)("strategy.management.today")),1)]),_:1}),i(I,{size:"small",onClick:e[12]||(e[12]=E=>z("next-month"))},{default:m(()=>[h(o(s(t)("strategy.management.nextMonth")),1)]),_:1})]),_:1}),u("div",it,o(p),1)]),"date-cell":m(({data:p})=>[u("div",{class:"cell",onClick:E=>_e(p)},[u("span",null,o(p.day.split("-")[2])+o(s(T)==="zh"?"日":""),1),ve.value(p.day)?(g(),x("span",{key:0,title:$.value.template_name},o($.value.template_name),9,mt)):(g(),x("span",ct," "))],8,dt)]),_:1},8,["modelValue"]),u("div",pt,[u("div",gt,o(s(q)("strategy.management.detail")),1),ye.value?(g(),x("div",vt,[u("div",yt,o((l=$.value)==null?void 0:l.template_name),1),u("div",_t,o(s(q)(s(Ae).find(p=>p.value===$.value.strategy_type).label))+"-"+o((b=$.value)==null?void 0:b.template_name),1),i(Oe,{steps:te.value,"show-time":!1,legends:[]},null,8,["steps"]),u("div",ft,[(g(!0),x(P,null,j(te.value||[],(p,E)=>(g(),x("div",{key:`${p.control_type}-${E}`,class:"flex justify-between text-[10px]"},[u("span",null,o(p.start_time)+"-"+o(p.end_time),1),u("span",null,o(ce.value(p.control_type)),1),u("span",null,o(s(q)("strategy.management.planPower"))+o(p.planned_power),1)]))),128))])])):ue("",!0)])]}),_:1},8,["label"])]),_:1},8,["modelValue"])])),[[Ve,r.value]])]),_:1})}}}),Vt=Pe(ht,[["__scopeId","data-v-bc1432fc"]]);export{Vt as default};
