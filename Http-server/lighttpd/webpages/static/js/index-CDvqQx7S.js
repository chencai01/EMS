var se=Object.defineProperty,ae=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var j=(m,l,e)=>l in m?se(m,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[l]=e,z=(m,l)=>{for(var e in l||(l={}))re.call(l,e)&&j(m,e,l[e]);if($)for(var e of $(l))le.call(l,e)&&j(m,e,l[e]);return m},J=(m,l)=>ae(m,ne(l));var g=(m,l,e)=>new Promise((v,u)=>{var n=p=>{try{S(e.next(p))}catch(y){u(y)}},o=p=>{try{S(e.throw(p))}catch(y){u(y)}},S=p=>p.done?v(p.value):Promise.resolve(p.value).then(n,o);S((e=e.apply(m,l)).next())});import{d as oe,j as ie,r as b,l as ue,G as ce,a as f,L as me,o as w,m as D,w as c,M as de,c as R,f as d,F as _e,n as pe,s as U,y as G,b as B,e as q,t as x,u as T,aM as W,aL as M,am as E,E as i,_ as ve}from"./index-B378b16y.js";import{s as ge,d as fe,t as X,a as ye,u as he}from"./strategy-E9FIk1WK.js";import we from"./index-CptHuBbh.js";import xe from"./TemplateInfo-RLQXP0Vy.js";import{A as k,S as Te,M as Se,p as Ce}from"./utils-CABZ3EnZ.js";import"./station-Dy7Yu9lE.js";import"./TimeSelect-DFXJ_pss.js";import"./TimeStep-CdBM5cGM.js";const ke={class:"template-container"},Ie={class:"text-primary"},be={class:"content-item justify-center mt-[20px]"},H=12,De=oe({name:"StratedyTemplate",__name:"index",setup(m){const l=()=>({startIndex:0,startTime:"00:00",endIndex:null,endTime:null,type:null,power:null}),{t:e}=ie(),v=b(!0),u=b([]),n=b(null),o=b("");ue(()=>n.value,t=>{o.value=t.uuid});const S=t=>{var s;return!t.template_name||!t.template_name.trim()?(i.warning(e("strategy.rules.name")),!1):((s=t.time_selects[t.time_selects.length-1])==null?void 0:s.endIndex)!=Se?(i.warning(e("strategy.rules.time")),!1):t.time_selects.filter(r=>Ce(r.type,r.power)).length>0?(i.warning(e("strategy.planingPowerWarning")),!1):+t.soc_upper_limit<=0||+t.soc_lower_limit<=0?(i.warning(e("strategy.rules.soc")),!1):t.soc_upper_limit<=t.soc_lower_limit?(i.warning(e("strategy.rules.soc1")),!1):(t.max_volt_single_cell_threshold||t.min_volt_single_cell_threshold)&&t.max_volt_single_cell_threshold<=t.min_volt_single_cell_threshold?(i.warning(e("strategy.rules.volt")),!1):!0},p=t=>{const a=JSON.parse(JSON.stringify(t));return a.basic_parameters=a.time_selects.map(s=>[k[s.startIndex],k[s.endIndex],s.type,s.power]),delete a.time_selects,a},y=()=>{n.value=X(),n.value.time_selects=[l()]},N=()=>{const t=u.value.find(a=>a.uuid===o.value);!u.value.length||W(t,n.value)?y():M.confirm(e("strategy.message.switch"),"",{type:"warning"}).then(()=>{y()})},O=(t,a,s)=>g(this,null,function*(){S(t)&&M.confirm(s,e("login.tips"),{type:"warning"}).then(()=>g(this,null,function*(){try{v.value=!0;const r=p(t),_=t.uuid?he:ye,{code:A}=yield _(r);+A==200?(i.success(t.uuid?e("request.updateSuccess"):e("request.addSuccess")),a&&a()):i.error(e("request.error"))}catch(r){console.error(r),v.value=!1,i.error(e("request.error"))}}))}),C=()=>g(this,null,function*(){var t;try{v.value=!0;const{data:a}=yield ge();u.value=((t=a==null?void 0:a.strategy)==null?void 0:t.slice(0,H))||[],u.value.length?(u.value.forEach(s=>{var r;(r=s.basic_parameters)!=null&&r.length?s.time_selects=s.basic_parameters.map(_=>({startIndex:k.indexOf(_.start_time),startTime:_.start_time,endIndex:k.indexOf(_.end_time),endTime:_.end_time,type:_.control_type,power:_.planned_power})):s.time_selects=[{startIndex:0,startTime:k[0],endIndex:null,endTime:null,type:null,power:null}],o.value===s.uuid&&(n.value=E(s))}),o.value===""&&(n.value=E(u.value[u.value.length-1]))):N()}catch(a){console.error(a),i.error(e("request.error"))}finally{v.value=!1}}),K=()=>{const t=o.value===""?e("strategy.message.save"):e("strategy.message.update");O(n.value,()=>{C()},t)},Q=()=>{if(o.value===""){i.warning(e("strategy.message.exist"));return}const t=J(z({},n.value),{template_name:`${n.value.template_name}-${e("buttons.hscopy")}`.substring(0,10),uuid:""});O(t,()=>{o.value="",C()},e("strategy.message.saveas"))},Y=()=>g(this,null,function*(){if(o.value===""){i.warning(e("strategy.message.exist"));return}M.confirm(e("strategy.message.delete"),"",{type:"warning"}).then(()=>g(this,null,function*(){try{const{code:t}=yield fe({uuid:o.value});+t==200?(o.value="",C(),i.success(e("request.deleteSuccess"))):i.error(e("request.deleteFail"))}catch(t){i.error(e("request.deleteFail"))}}))});ce(()=>g(this,null,function*(){yield C()}));const Z=t=>{if(n.value&&n.value.uuid===t.uuid)return;let a=null;const s=u.value.find(r=>r.uuid===t.uuid);if(o.value===""){const r=X();r.time_selects=[l()],a=r}else a=u.value.find(r=>r.uuid===o.value);W(a,n.value)?n.value=E(s):M.confirm(e("strategy.message.switch"),"",{type:"warning"}).then(()=>{n.value=E(s)})};return(t,a)=>{const s=f("el-card"),r=f("el-col"),_=f("Plus"),A=f("el-icon"),L=f("el-row"),ee=f("el-divider"),I=f("el-button"),te=me("load");return w(),D(we,{"active-name":"template"},{default:c(()=>[de((w(),R("div",ke,[d(L,{gutter:12,class:"mb-[20px]"},{default:c(()=>[d(r,{span:24},{default:c(()=>[d(L,{gutter:12},{default:c(()=>[(w(!0),R(_e,null,pe(u.value,h=>(w(),D(r,{key:h.uuid,span:4},{default:c(()=>{var F,P;return[d(s,{shadow:((F=n.value)==null?void 0:F.uuid)===h.uuid?"always":"hover",class:U(["card",{active:((P=n.value)==null?void 0:P.uuid)===h.uuid}]),onClick:V=>Z(h)},{default:c(()=>[B("p",Ie,x(T(e)(T(Te).find(V=>V.value===h.strategy_type).label)),1),B("p",null,x(h.template_name),1)]),_:2},1032,["shadow","class","onClick"])]}),_:2},1024))),128)),u.value.length<H?(w(),D(r,{key:0,span:4},{default:c(()=>[d(s,{shadow:"hover",class:U(["card",{active:o.value===""}]),onClick:N},{default:c(()=>[d(A,{size:"large"},{default:c(()=>[d(_,{class:"relative top-[4px]"})]),_:1})]),_:1},8,["class"])]),_:1})):G("",!0)]),_:1})]),_:1})]),_:1}),d(ee,{"border-style":"dashed"}),n.value?(w(),D(xe,{key:0,template:n.value},null,8,["template"])):G("",!0),B("div",be,[d(I,{icon:"Refresh",onClick:C},{default:c(()=>[q(x(T(e)("strategy.management.refresh")),1)]),_:1}),d(I,{icon:"Document",onClick:K},{default:c(()=>[q(x(T(e)("strategy.management.save")),1)]),_:1}),d(I,{icon:"DocumentCopy",onClick:Q},{default:c(()=>[q(x(T(e)("strategy.management.saveAs")),1)]),_:1}),d(I,{icon:"Delete",onClick:Y},{default:c(()=>[q(x(T(e)("strategy.management.delete")),1)]),_:1})])])),[[te,v.value]])]),_:1})}}}),Pe=ve(De,[["__scopeId","data-v-bca85cb0"]]);export{Pe as default};
