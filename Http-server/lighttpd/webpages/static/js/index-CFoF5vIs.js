var x=(A,z,C)=>new Promise((t,T)=>{var e=y=>{try{r(C.next(y))}catch(v){T(v)}},Y=y=>{try{r(C.throw(y))}catch(v){T(v)}},r=y=>y.done?t(y.value):Promise.resolve(y.value).then(e,Y);r((C=C.apply(A,z)).next())});import{d as le,r as E,I as k,m as Z,l as ue,p as O,G as pe,a as h,o as d,b,f as V,e as m,w as g,F as U,i as j,u as i,q as I,y as ie,g as B,t as f,aN as w,_ as ce}from"./index-BSlF4gO8.js";import{u as F,w as de}from"./xlsx-DaVhO591.js";import{a as ee}from"./eventQuery-BO16v0CD.js";import{h as N,c as R,l as $,d as te}from"./columns-pva7bKn_.js";const ye={class:"main"},me={class:"content"},fe={key:0},_e={key:1},he={key:2},ge={key:3},ve={key:4},be={class:"page"},De={class:"total"},qe={class:"jumper"},ke={class:"mr-2 pt-[5px]"},we={class:"ml-2 pt-[5px]"},Ce=le({name:"HistoryEvent",__name:"index",setup(A){const z=E(),C=E([k(new Date).startOf("day").toDate(),k(new Date).endOf("day").toDate()]),t=Z({historyColumns:[null,null,null],date:C}),T=()=>{const a=t.date[1];a.setHours(23,59,59),t.date[1]=a},{t:e}=ue(),Y=E(1),r=Z({total:0,pageSize:10,currentPage:1,background:!0}),y=E([]),v=E([]),L=()=>x(this,null,function*(){var a;try{if(t.date.length>1&&t.date[0]&&t.date[1]){const{code:s,data:u}=yield ee(k(new Date(t.date[0])).format("YYYY-MM-DD HH:mm:ss"),k(new Date(t.date[1])).format("YYYY-MM-DD HH:mm:ss"),t.historyColumns[0],t.historyColumns[1],t.historyColumns[2],r.pageSize,r.currentPage);if(+s==200){const D=te((u==null?void 0:u.historyEvent)||[])||[];N[2].options=D,y.value=u.historyEvent,r.total=u.total,(a=y.value)==null||a.forEach((_,n)=>{_.index=(P.value-1)*10+n+1})}else w(e("request.error"),{type:"error"})}else w("请选择正确的时间范围",{type:"error"})}catch(s){w(e("request.error"),{type:"error"})}finally{setTimeout(()=>{},500)}}),ae=()=>x(this,null,function*(){var a;try{if(t.date.length>1&&t.date[0]&&t.date[1]){const{code:s,data:u}=yield ee(k(new Date(t.date[0])).format("YYYY-MM-DD HH:mm:ss"),k(new Date(t.date[1])).format("YYYY-MM-DD HH:mm:ss"),t.historyColumns[0],t.historyColumns[1],t.historyColumns[2],r.total,1);if(+s==200){const D=te((u==null?void 0:u.historyEvent)||[])||[];N[2].options=D,v.value=u.historyEvent,r.total=u.total,(a=v.value)==null||a.forEach((_,n)=>{_.index=n+1})}else w(e("request.error"),{type:"error"})}else w("请选择正确的时间范围",{type:"error"})}catch(s){w(e("request.error"),{type:"error"})}finally{setTimeout(()=>{},500)}});function G(a){switch(a){case 1:return e("query.cabinet");case 2:return e("query.stack");case 3:return e("query.cluster");case 4:return e("query.ac");case 5:return e("query.meter");case 6:return e("query.pcs");case 7:return e("query.sensor");case 8:return e("query.dido");default:return e("query.other")}}function J(a){switch(a){case 0:return e("query.restore");case 1:return e("query.generate")}}function W(a){switch(a){case 1:return e("query.level 1");case 2:return e("query.level 2")}}function K(a){return a!=null?a=="vacant"?"-":a.includes("#")?a.split(" ")[0]+" "+e(`query.${a.split(" ").slice(1).join(" ")}`):e(`query.${a.replace(".","_&_")}`):""}function Q(){return x(this,null,function*(){$.value=!0,r.currentPage=1,L(),setTimeout(()=>{$.value=!1},500)})}const P=E(r.currentPage);function oe(){r.currentPage=parseInt(P.value)}O(()=>r.currentPage,a=>{P.value=a,L()});function X(){return x(this,null,function*(){r.currentPage=1,r.pageSize=10,t.historyColumns[0]=null,t.historyColumns[1]=null,t.historyColumns[2]=null,t.date=[k(new Date).startOf("day").toDate(),k(new Date).endOf("day").toDate()],L()})}const se=()=>x(this,null,function*(){yield ae();const a=v==null?void 0:v.value.map(n=>{const p=[];return R.forEach(l=>{if(l.prop==="occurTime"||l.prop==="endTime"){const c=new Date(n[l.prop]),S=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(c);p.push(S)}else if(l.prop==="device_type"){const c=G(n[l.prop]);p.push(c)}else if(l.prop==="state"){const c=J(n[l.prop]);p.push(c)}else if(l.prop=="level"){const c=W(n[l.prop]);p.push(c)}else if(l.prop==="description"){const c=K(n[l.prop]);p.push(c)}else p.push(n[l.prop])}),p}),s=[];R.forEach(n=>{s.push(e("query."+n.prop))}),a.unshift(s);const u=F.aoa_to_sheet(a),D=F.book_new(),_=[];for(let n=0;n<a[0].length;n++){let p=0;for(let l=0;l<a.length;l++){const c=a[l][n]!==null?String(a[l][n]):"";p=Math.max(p,c.length)}_.push({wch:p+8})}u["!cols"]=_,F.book_append_sheet(D,u,"历史事件"),de(D,"HistoryEvent.xlsx"),w("导出成功",{type:"success"})});return O(()=>Y.value,()=>{X(),L()}),O(()=>(t.historyColumns[0],t.historyColumns[1],t.historyColumns[2]),(a,s,u)=>{}),pe(()=>{L()}),(a,s)=>{const u=h("el-option"),D=h("el-select"),_=h("el-form-item"),n=h("el-date-picker"),p=h("el-button"),l=h("el-form"),c=h("el-table-column"),S=h("el-table"),re=h("el-pagination"),ne=h("el-input");return d(),b("div",ye,[V("div",me,[m(l,{ref_key:"formRef",ref:z,inline:!0,class:"search-form",model:t},{default:g(()=>[(d(!0),b(U,null,j(i(N),(o,q)=>(d(),I(_,{key:o.prop},{default:g(()=>[m(D,{modelValue:t.historyColumns[q],"onUpdate:modelValue":H=>t.historyColumns[q]=H,size:"small",placeholder:i(e)("query."+o.prop),clearable:"",class:"!w-[161px]"},{default:g(()=>{var H;return[((H=o.options)==null?void 0:H.length)>0?(d(!0),b(U,{key:0},j(o.options,M=>(d(),I(u,{key:M.value,label:o.prop==="device_sn"?M.label:i(e)("query."+M.label),value:M.value},null,8,["label","value"]))),128)):ie("",!0)]}),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024))),128)),m(_,{prop:"date"},{default:g(()=>[m(n,{modelValue:t.date,"onUpdate:modelValue":s[0]||(s[0]=o=>t.date=o),type:"daterange",clearable:!1,size:"small","unlink-panels":"","range-separator":"~","start-placeholder":i(e)("date.startDate"),"end-placeholder":i(e)("date.endDate"),"disabled-date":o=>o.getTime()>Date.now(),"suffix-icon":"el-icon-date",onChange:T},null,8,["modelValue","start-placeholder","end-placeholder","disabled-date"])]),_:1}),m(_,{class:"form-button"},{default:g(()=>[m(p,{type:"primary",size:"small",onMousedown:s[1]||(s[1]=o=>o.preventDefault()),onClick:Q},{default:g(()=>[B(f(i(e)("query.search")),1)]),_:1}),m(p,{type:"primary",size:"small",onMousedown:s[2]||(s[2]=o=>o.preventDefault()),onClick:X},{default:g(()=>[B(f(i(e)("query.reset")),1)]),_:1}),m(p,{type:"primary",size:"small",onMousedown:s[3]||(s[3]=o=>o.preventDefault()),onClick:se},{default:g(()=>[B(f(i(e)("query.export")),1)]),_:1})]),_:1})]),_:1},8,["model"]),m(S,{modelValue:Y.value,"onUpdate:modelValue":s[4]||(s[4]=o=>Y.value=o),class:"puretable",data:y.value,"align-whole":"center","table-layout":"auto",border:"",loading:i($),onRefresh:Q},{default:g(()=>[(d(!0),b(U,null,j(i(R),o=>(d(),I(c,{key:o.prop,prop:o.prop,label:i(e)("query."+o.prop),class:"tableColumn",sortable:o.prop==="occurTime",formatter:o.formatter,align:"center"},{default:g(({row:q})=>[o.prop==="state"?(d(),b("span",fe,f(J(q.state)),1)):o.prop==="device_type"?(d(),b("span",_e,f(G(q.device_type)),1)):o.prop==="description"?(d(),b("span",he,f(K(q.description)),1)):o.prop==="level"?(d(),b("span",ge,f(W(q.level)),1)):(d(),b("span",ve,f(q[o.prop]),1))]),_:2},1032,["prop","label","sortable","formatter"]))),128))]),_:1},8,["modelValue","data","loading"]),V("div",be,[V("div",De,f(i(e)("query.total",{total:r.total})),1),m(re,{currentPage:r.currentPage,"onUpdate:currentPage":s[5]||(s[5]=o=>r.currentPage=o),"page-size":r.pageSize,total:r.total,background:!0,pagination:r,layout:" prev, pager, next"},null,8,["currentPage","page-size","total","pagination"]),V("div",qe,[V("span",ke,f(i(e)("query.goto")),1),m(ne,{modelValue:P.value,"onUpdate:modelValue":s[6]||(s[6]=o=>P.value=o),type:"text",class:"el-pagination__editor custom-input",onChange:oe},null,8,["modelValue"]),V("span",we,f(i(e)("query.page")),1)])])])])}}}),Pe=ce(Ce,[["__scopeId","data-v-c3144bd3"]]);export{Pe as default};
