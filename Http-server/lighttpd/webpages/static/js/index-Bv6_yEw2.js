var T=(z,d,M)=>new Promise((_,s)=>{var C=n=>{try{r(M.next(n))}catch(P){s(P)}},p=n=>{try{r(M.throw(n))}catch(P){s(P)}},r=n=>n.done?_(n.value):Promise.resolve(n.value).then(C,p);r((M=M.apply(z,d)).next())});import{d as re,l as ve,r as c,p as U,c as ee,K as ie,G as de,H as pe,a as le,o as x,q as $,w as b,f as O,b as F,e as L,g,t as V,u as G,F as H,i as K,y as fe,A as me,_ as be}from"./index-BSlF4gO8.js";import _e from"./index-8dw8MoHK.js";import{r as ye,a as ke}from"./pack-C-9XZzM4.js";import{C as Ce}from"./cluster-JMpJuoxf.js";import{u as j}from"./pack-dQihO1_7.js";import{v as A}from"./valueUtil-BReNmlgC.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-DgsXbc5O.js";import{_ as Me}from"./index.vue_vue_type_script_setup_true_lang-Dtm1_sj1.js";import Pe from"./index-MpxwV3WD.js";import Se from"./index-BdsrIN2D.js";import"./icon-settings-BE6Rst9v.js";import"./WarningsUtil-CTO3mp7U.js";import"./CardTemplate-DuLm1zS3.js";import"./tableStyle-qj-JclAQ.js";const Te={class:"page-container"},ge={key:0,class:"grid-opt flex justify-between mb-[16px]"},Ve={class:"flex"},he={class:"mr-[8px]"},Ie={class:"mr-[8px]"},h=0,I=-40,we=re({name:"DevicePack",__name:"index",setup(z){const{t:d}=ve(),M=[{label:d("pack.energyStorageCabinet",{number:1}),value:1}],_=c([]),s=c([]),C=c(null),p=c(null),r=c(null),n=c(null),P=c(M[0].value),w=c({});let E=[];const Q=c([]),R=c([]),W=c([]),X=l=>{var u,v;if(!l||!`${l==null?void 0:l.label}`||!`${l==null?void 0:l.value}`)return;const o=(u=w.value[`${l.value}`])==null?void 0:u.clusters;o&&(s.value=Object.keys(o).map(e=>({label:d("pack.batteryCluster",{number:parseInt(e)}),value:parseInt(e)})),p.value!=null&&!s.value.some(e=>{var a,t;return(e==null?void 0:e.label)==((a=p.value)==null?void 0:a.label)&&(e==null?void 0:e.value)==((t=p.value)==null?void 0:t.value)})&&s.value.length>0&&(p.value=s.value[0],n.value=(v=s.value[0])==null?void 0:v.value))},ae=()=>T(this,null,function*(){var l,o,u,v,e;try{const a=yield Ce.requestAllClusters();(a==null?void 0:a.code)==200?JSON.stringify((o=(l=a==null?void 0:a.data)==null?void 0:l.batteryCluster)!=null?o:[])!=JSON.stringify(E)&&(E=(u=a==null?void 0:a.data)==null?void 0:u.batteryCluster,w.value={},E.forEach(t=>{var y,k;const f=A.roundString(t.StackNo),m=(k=(y=w.value[f])==null?void 0:y.clusters)!=null?k:{};m[A.roundString(t.ClusterNo)]=t,w.value[f]={clusters:m}}),_.value=Object.keys(w.value).map(t=>({label:d("pack.batteryStack",{number:A.round(parseInt(t))}),value:A.round(parseInt(t))})),_.value.some(t=>{var f,m;return(t==null?void 0:t.label)==((f=C.value)==null?void 0:f.label)&&(t==null?void 0:t.value)==((m=C.value)==null?void 0:m.value)})||(C.value=_.value[0],r.value=(v=_.value[0])==null?void 0:v.value),X(C.value),s.value.some(t=>{var f,m;return(t==null?void 0:t.label)==((f=p.value)==null?void 0:f.label)&&(t==null?void 0:t.value)==((m=p.value)==null?void 0:m.value)})||(p.value=s.value[0],n.value=(e=s.value[0])==null?void 0:e.value)):(console.warn("-- setDefaultStackAndClustersWithRequest invalid code",a==null?void 0:a.code),Y())}catch(a){console.warn("-- setDefaultStackAndClustersWithRequest error",a==null?void 0:a.message),Y()}}),Y=()=>{var l,o;_.value=[{label:d("pack.batteryStack",{number:1}),value:1}],s.value=[{label:d("pack.batteryCluster",{number:1}),value:1}],r.value=(l=_.value[0])==null?void 0:l.value,n.value=(o=s.value[0])==null?void 0:o.value,B()},B=()=>T(this,null,function*(){try{const l=yield ye(r.value,n.value);l.code==200?Q.value=l.data.cellVolt:console.warn("--[pack] requestAllPackCellVolt invalid code",l.code);const o=yield ke(r.value,n.value);o.code==200?R.value=o.data.cellTemp:console.warn("--[pack] requestAllPackCellTemp invalid code",o.code),W.value=Q.value.map((u,v)=>{const e=u.every(i=>i===u[0]),a=Math.max(...u),t=Math.min(...u),f=u.findIndex(i=>+i===a),m=u.findIndex(i=>+i===t),y=R.value[v],k=y.every(i=>i===y[0]),D=Math.max(...y),N=Math.min(...y),se=y.findIndex(i=>+i===D),ce=y.findIndex(i=>+i===N);return{index:v+1,MaxCellVolt:e&&a===h?"--":a,MaxCellVoltPositon:e&&a!==h?1:e&&a===h?"--":f+1,MinCellVolt:e&&t===h?"--":t,MinCellVoltPositon:e&&t!==h?1:e&&t===h?"--":m+1,MaxCellTemp:k&&D===I?"--":D,MaxCellTempPosition:k&&D!==I?1:k&&D===I?"--":se+1,MinCellTemp:k&&N===I?"--":N,MinCellTempPosition:k&&N!==I?1:k&&N===I?"--":ce+1}})}catch(l){console.warn("--[pack] --requestAllPackInfo error:",l)}});U(()=>r.value,(l,o)=>T(this,null,function*(){C.value&&l!==o&&(X(C.value),B())}),{deep:!0}),U(()=>n.value,(l,o)=>T(this,null,function*(){p.value&&l!==o&&B()}),{deep:!0});const q=c(j().layoutType||"card"),te=l=>{q.value=l};U(()=>q.value,l=>{j().setLayoutType(l)});const S=c(j().columnNum),oe=l=>{S.value=l};U(()=>S.value,l=>{j().setColumnNum(l)});const ne=ee(()=>{if(q.value==="list")return Se;if(q.value==="card"){if(S.value===2)return xe;if(S.value===3)return Me;if(S.value===4)return Pe}return null}),{$storage:J}=ie(),ue=ee(()=>{var l;return parseInt(((l=J==null?void 0:J.configure)==null?void 0:l.timer)||1e3)}),Z=c(null);return de(()=>T(this,null,function*(){yield ae(),Z.value=setInterval(()=>{B()},ue.value)})),pe(()=>{clearInterval(Z.value)}),(l,o)=>{const u=le("el-option"),v=le("el-select");return x(),$(_e,{"active-name":"pack",type:q.value,"slider-value":S.value,onTypeClick:te,onSliderChange:oe},{default:b(()=>[O("div",Te,[W.value.length!==0?(x(),F("div",ge,[O("div",Ve,[O("div",he,[L(v,{modelValue:P.value,"onUpdate:modelValue":o[0]||(o[0]=e=>P.value=e)},{prefix:b(()=>[g(V(G(d)("pack.cabinet")),1)]),default:b(()=>[(x(),F(H,null,K(M,(e,a)=>L(u,{key:a,value:e.value,label:e.label},{default:b(()=>[g(V(e.label),1)]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])]),O("div",Ie,[L(v,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=e=>r.value=e)},{prefix:b(()=>[g(V(G(d)("pack.stack")),1)]),default:b(()=>[(x(!0),F(H,null,K(_.value,(e,a)=>(x(),$(u,{key:a,value:e.value,label:e.label},{default:b(()=>[g(V(e.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),O("div",null,[L(v,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=e=>n.value=e)},{prefix:b(()=>[g(V(G(d)("pack.cluster")),1)]),default:b(()=>[(x(!0),F(H,null,K(s.value,(e,a)=>(x(),$(u,{key:a,value:e.value,label:e.label},{default:b(()=>[g(V(e.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])])])])):fe("",!0),(x(),$(me(ne.value),{"all-pack-info":W.value,"stack-selected-value":r.value,"cluster-selected-value":n.value},null,8,["all-pack-info","stack-selected-value","cluster-selected-value"]))])]),_:1},8,["type","slider-value"])}}}),He=be(we,[["__scopeId","data-v-76ff1467"]]);export{He as default};
