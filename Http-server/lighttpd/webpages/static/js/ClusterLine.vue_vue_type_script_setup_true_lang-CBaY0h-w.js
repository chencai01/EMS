var N=Object.defineProperty,j=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var O=(i,e,n)=>e in i?N(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,p=(i,e)=>{for(var n in e||(e={}))X.call(e,n)&&O(i,n,e[n]);if(L)for(var n of L(e))Y.call(e,n)&&O(i,n,e[n]);return i},u=(i,e)=>j(i,W(e));var E=(i,e,n)=>new Promise((C,f)=>{var g=s=>{try{y(n.next(s))}catch(r){f(r)}},S=s=>{try{y(n.throw(s))}catch(r){f(r)}},y=s=>s.done?C(s.value):Promise.resolve(s.value).then(g,S);y((n=n.apply(i,e)).next())});import{d as H,I as P,j as F,au as R,r as q,x as G,aT as U,l as B,o as Z,m as J,w as K,b as Q}from"./index-B378b16y.js";import{_ as ee,C as te}from"./index.vue_vue_type_script_setup_true_lang-60eETwKU.js";import{v as o}from"./valueUtil-BReNmlgC.js";import{u as ae}from"./useTimer-u5e-KjxW.js";const h=5,le="display:inline-flex; align-items: center; width: 100%;",ne="display:inline-flex; flex:1; justify-content: flex-end; margin-left: 10px;",ce=H({__name:"ClusterLine",props:{height:{type:String,default:"156px"},day:{type:String,default:P(new Date).format("YYYY-MM-DD")},sn:{type:String,default:"1"},cn:{type:String,default:"1"}},setup(i){const{t:e}=F(),n=i,{isDark:C}=R(),{locale:f}=F(),g=q(null),S=G(()=>C.value?"dark":"default"),{setOptions:y}=U(g,{theme:S});let s=[],r=[],_=[],A=[],k=[],T=[],w=[],$=[];const x={type:"value",nameGap:20,nameLocation:"end",nameTextStyle:{fontSize:12,lineHeight:16,fontWeight:"bold",color:"#666666",verticalAlign:"middle"},splitLine:{show:!0,lineStyle:{type:"dashed",color:"#dddddd",dashOffset:4}},splitNumber:h,min:0,axisLine:{show:!0},axisLabel:{fontSize:12,lineHeight:16,fontWeight:"normal",color:"#666666",formatter:l=>`${o.round(l)}`},triggerEvent:!0};let V=100,D=1e3,M=80,v=100;const m=(l,a,c,d)=>`${l.length?"<br />":""}<span style="${le}">${a.marker}${a.seriesName}: <span style="${ne}">${c} <span style="display:inline-flex; align-items: center;justify-content: flex-end; width: 17px">${d}</span></span></span>`,z=()=>{y({animation:!1,tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(l){var c,d;let a=(d=(c=l==null?void 0:l[0])==null?void 0:c.name)!=null?d:"";return l.forEach(t=>{switch(t.seriesName){case"SOC":a+=m(a,t,o.roundString(t.value,1),"%");break;case e("cluster.detail.totalCurrent"):a+=m(a,t,o.roundString(t.value,1),"A");break;case e("cluster.detail.totalVolt"):a+=m(a,t,o.roundString(t.value,1),"V");break;case e("cluster.detail.maxCellTemp"):a+=m(a,t,t.value,"℃");break;case e("cluster.detail.minCellTemp"):a+=m(a,t,t.value,"℃");break;case e("cluster.detail.maxCellVolt"):a+=m(a,t,o.roundString(t.value,3),"V");break;case e("cluster.detail.minCellVolt"):a+=m(a,t,o.roundString(t.value,3),"V");break}}),a}},grid:{left:"100px",top:"36px",bottom:"76px",right:"100px"},legend:{bottom:!0,data:["SOC",e("cluster.detail.totalCurrent"),e("cluster.detail.totalVolt"),e("cluster.detail.maxCellTemp"),e("cluster.detail.minCellTemp"),e("cluster.detail.maxCellVolt"),e("cluster.detail.minCellVolt")],icon:"rect",itemWidth:8,itemHeight:4},calculable:!0,xAxis:[{triggerEvent:!0,type:"category",splitLine:{show:!1},axisTick:{show:!1,alignWithLabel:!0},data:s,axisLabel:{color:"#666666",fontSize:12,formatter:l=>l==null?void 0:l.substring(l.indexOf(" ")+1,l==null?void 0:l.lastIndexOf(":"))}}],yAxis:[u(p({},x),{axisLabel:u(p({},x.axisLabel),{formatter:l=>`${o.roundString(l,1)}`}),position:"left",offset:50,name:"A",max:V,interval:V/h}),u(p({},x),{position:"left",offset:0,name:"V",max:D,interval:D/h}),u(p({},x),{position:"right",offset:0,name:"%",max:v,interval:v/h}),u(p({},x),{position:"right",offset:50,name:"℃",max:M,interval:M/h})],dataZoom:[{type:"slider",show:!0,realtime:!0,bottom:"30px",start:s.length?(s.length-15)*100/s.length:0,end:100,height:22,showDetail:!1}],series:[{name:"SOC",yAxisIndex:2,type:"line",symbolSize:10,symbol:"none",itemStyle:{color:"#2250E0"},data:r},{name:e("cluster.detail.totalCurrent"),yAxisIndex:0,type:"line",symbolSize:10,symbol:"none",itemStyle:{color:"#18C8A6"},data:_},{name:e("cluster.detail.totalVolt"),yAxisIndex:1,type:"line",symbolSize:10,symbol:"none",itemStyle:{color:"#FF9900"},data:A},{name:e("cluster.detail.maxCellTemp"),yAxisIndex:3,type:"line",symbolSize:10,symbol:"none",itemStyle:{color:"#A959FF"},data:k},{name:e("cluster.detail.minCellTemp"),yAxisIndex:3,type:"line",symbolSize:10,symbol:"none",itemStyle:{color:"#10B8FA"},data:T},{name:e("cluster.detail.maxCellVolt"),yAxisIndex:1,type:"line",symbolSize:10,symbol:"none",itemStyle:{color:"#FF4D6D"},data:w},{name:e("cluster.detail.minCellVolt"),yAxisIndex:1,type:"line",symbolSize:10,symbol:"none",itemStyle:{color:"#89D943"},data:$}],addTooltip:!0},{name:"click",callback:l=>{}},{name:"contextmenu",callback:l=>{}},{type:"zrender",name:"click",callback:l=>{}})};B(()=>f.value,()=>{z()},{immediate:!1}),B(()=>n.day,()=>{I()},{immediate:!1});const b=l=>{const a=`${Math.abs(l)}`.length;return(o.round(l/Math.pow(10,a-1))+1)*Math.pow(10,a-1)},I=()=>E(this,null,function*(){var c,d;let l;try{l=yield te.requestCurve(`${n.day} 00:00:00`,`${n.day} 23:59:59`,2,5,4,+n.sn,+n.cn)}catch(t){}const a=(d=(c=l==null?void 0:l.data)==null?void 0:c.curve)!=null?d:[];s=a.map(t=>t.time),r=a.map(t=>t.soc),_=a.map(t=>t.total_current),A=a.map(t=>t.bat_voltage),k=a.map(t=>t.max_cell_temp),T=a.map(t=>t.min_cell_temp),w=a.map(t=>t.max_cell_volt),$=a.map(t=>t.min_cell_volt),V=b(Math.max(..._)),v=b(Math.max(...r)),M=b(Math.max(...k)),D=b(Math.max(Math.max(...A),Math.max(...w))),z()});return ae(()=>I(),{immediate:!0,immediateCallback:!0,time:60*1e3}),(l,a)=>(Z(),J(ee,{width:"100%",height:n.height},{default:K(()=>[Q("div",{ref_key:"lineChartRef",ref:g,style:{width:"100%",height:"100%"}},null,512)]),_:1},8,["height"]))}});export{ce as _};
