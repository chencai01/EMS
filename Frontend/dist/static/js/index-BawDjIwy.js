var le=Object.defineProperty,ae=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var P=(d,e,s)=>e in d?le(d,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[e]=s,M=(d,e)=>{for(var s in e||(e={}))oe.call(e,s)&&P(d,s,e[s]);if($)for(var s of $(e))se.call(e,s)&&P(d,s,e[s]);return d},I=(d,e)=>ae(d,te(e));var h=(d,e,s)=>new Promise((w,v)=>{var A=i=>{try{S(s.next(i))}catch(V){v(V)}},C=i=>{try{S(s.throw(i))}catch(V){v(V)}},S=i=>i.done?w(i.value):Promise.resolve(i.value).then(A,C);S((s=s.apply(d,e)).next())});import ne from"./index-zqP5zD92.js";import{s as R,g as de,a as ie}from"./env_dido--wV3HMyW.js";import{u as re}from"./useTimer-DPmIGUt7.js";import{d as ce,l as ue,r as b,a as L,o as r,q as ve,w as c,f as o,t as n,u as g,e as p,b as u,i as x,F as j,g as y,y as T,aL as Q,E as G,z as E,n as N,B as fe,C as ge,_ as pe}from"./index-BSlF4gO8.js";const F=d=>(fe("data-v-b2e2b857"),d=d(),ge(),d),me={class:"page-container"},_e={class:"top-left-container"},be={class:"switch-title"},ye={class:"center-rectangle"},Se=F(()=>o("div",{class:"center-text"},"DI/DO",-1)),he=F(()=>o("div",{class:"center-rectangle-circle"},null,-1)),Ce={class:"left-circle-number"},Ve={key:0,class:"left-small-rectangle-text"},ke=["onClick"],Fe=F(()=>o("div",{class:"left-small-rectangle-circle"},null,-1)),we=F(()=>o("hr",{class:"left-small-rectangle-line"},null,-1)),De={key:2,class:"left-small-rectangle-state"},Ae=F(()=>o("div",{class:"center-rectangle-circle"},null,-1)),Te={class:"right-circle-number"},Ee={class:"right-small-rectangle"},Oe=F(()=>o("div",{class:"right-small-rectangle-circle"},null,-1)),Be=F(()=>o("div",{class:"right-small-rectangle-line"},null,-1)),Le={class:"dialog-title"},$e={key:0,class:"flex justify-center items-center"},Pe={key:1,class:"flex justify-center items-center"},Me={key:2,class:"flex justify-center items-center"},Ie={key:3,class:"flex justify-center items-center"},Re={class:"dialog-footer"},z=500,xe=ce({name:"ManualInspection",__name:"index",setup(d){const{t:e}=ue(),s=b({}),w=b({}),v=b(),A=b(),C=b(!1),S=b([]),i=b(!1),V=b(!0),W=()=>h(this,null,function*(){try{return yield Q.confirm(i.value?e("dido.manualControlModeOff"):e("dido.manualControlModeOn"),i.value?e("dido.disabledTitle"):e("dido.enableTitle"),{type:"warning",closeOnClickModal:!1}),!0}catch(t){return!1}}),H=()=>{V.value=!0},U=()=>h(this,null,function*(){V.value=!1;const t=m.value.reduce((a,_)=>(a[_.name]=_.doStateValue,a),{ControlMode:i.value?1:0});yield R(t),setTimeout(H,z)}),m=b([{label:e("dido.QF1Tripping"),value:1,name:"QF1GridTripEnable",doStateValue:null,seleted:!0},{label:e("dido.QF2Tripping"),value:2,name:"QF2BatTripEnable",doStateValue:null,seleted:!0},{label:e("dido.RemoteEmergencyStop"),value:3,name:"RemoteEmergencyStop",doStateValue:null,seleted:!0},{label:e("dido.AerosolSensor1"),value:4,name:"Aerosol1",doStateValue:null,seleted:!0},{label:e("dido.RunLight"),value:5,name:"RunLightTripEnable",doStateValue:null,ifPassed:null,seleted:!0},{label:e("dido.WarningLight"),value:6,name:"FaultLightTripEnable",doStateValue:null,ifPassed:null,seleted:!0},{label:e("dido.ExhaustFan"),value:7,name:"FanStartStop",doStateValue:null,ifPassed:null,seleted:!0},{label:e("dido.AcoustoOptic"),value:8,name:"AcoustoOptic",doStateValue:null,ifPassed:null,seleted:!0}]),O=[{label:e("dido.EmergencyStop"),value:"A1",name:"EmergencyStop",flag:0},{label:e("dido.QF1OF"),value:"A2",name:"QF1GridFeedback",flag:1},{label:e("dido.QF2OF"),value:"A3",name:"QF2BatFeedback",flag:1},{label:e("dido.WaterSensor"),value:"B4",name:"WaterSensor",flag:0},{label:e("dido.AerosolSensor12"),value:"B5",detail:e("dido.BatteryAndElectrical"),name:"AerosolSensor",flag:0},{label:e("dido.AccessControl1"),value:"B6",detail:e("dido.BatteryRoom"),name:"BmsAccessControl",flag:1},{label:e("dido.GasLowAlarm"),value:"C7",name:"GasLowAlarm",flag:0},{label:e("dido.GasHighAlarm"),value:"C8",name:"GasHighAlarm",flag:0},{label:e("dido.AccessControl2"),value:"D10",detail:e("dido.ElectricalRoom"),name:"ElecAccessControl",flag:1},{label:e("dido.LightningSignal"),value:"D11",detail:e("dido.ThreePower"),name:"LtgProtsignal",flag:0},{label:e("dido.TempSensor"),value:"E13",name:"TempSensor",flag:0},{label:e("dido.SmokeSensor"),value:"E14",name:"SmokeSensor",flag:0}],q=()=>h(this,null,function*(){try{const t=yield de(1);t.code==200?(s.value=t.data,S.value=O.map(a=>I(M({},a),{diStateValue:s.value[a.name]}))):(S.value=O,console.warn("--[env_dido] getDi invalid code",t.code))}catch(t){S.value=O,console.warn("--[env_dido] --getDi error:",t)}}),J=()=>h(this,null,function*(){try{const t=yield ie(1);t.code==200?(w.value=t.data,m.value.forEach(a=>{a.doStateValue=w.value[a.name]}),w.value.ControlMode===1?i.value=!0:i.value=!1):console.warn("--[env_dido] getDo invalid code",t.code)}catch(t){console.warn("--[env_dido] --getDo error:",t)}}),B={0:{0:`(${e("dido.NotTripped")})`,1:`(${e("dido.Tripping")})`},2:{0:`(${e("dido.Closed")})`,1:`(${e("dido.Open")})`},4:{0:`(${e("dido.LightsOff")})`,1:`(${e("dido.LightsOn")})`},6:{0:`(${e("dido.Stop")})`,1:`(${e("dido.Run")})`}},K=t=>{const a=t%2===0?t:t-1,_=m.value[t].doStateValue;return B[a]&&B[a][_]?B[a][_]:""},X=t=>{Object.keys(w.value).length>0&&(i.value?(C.value=!0,v.value=t,A.value=m.value[t].label):Q.alert(e("dido.manualControlModeOnTips"),e("dido.Tips"),{type:"warning"}))},Y=()=>h(this,null,function*(){C.value=!1,m.value[v.value].ifPassed=1,G({type:"success",message:e("dido.InspectionPassed"),duration:1e3})}),Z=()=>h(this,null,function*(){C.value=!1,m.value[v.value].ifPassed=0,G({type:"error",message:e("dido.InspectionFailed"),duration:1e3})}),k=t=>h(this,null,function*(){t==="off"?m.value[v.value].doStateValue=0:t==="on"&&(m.value[v.value].doStateValue=1);const a=m.value.reduce((_,f)=>(_[f.name]=f.doStateValue,_),{ControlMode:1});yield R(a)});return re(()=>{V.value&&(q(),J())},{time:z,immediate:!0,immediateCallback:!0}),(t,a)=>{const _=L("el-switch"),f=L("el-button"),ee=L("el-dialog");return r(),ve(ne,{"active-name":"manualInspection"},{default:c(()=>[o("div",me,[o("div",_e,[o("p",be,n(g(e)("dido.DOManualControl")),1),p(_,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=l=>i.value=l),"before-change":W,onChange:U},null,8,["modelValue"])]),o("div",ye,[Se,(r(!0),u(j,null,x(m.value,(l,D)=>(r(),u("div",{key:l.value,class:"center-rectangle-left-side"},[he,o("div",Ce,n("DO"+l.value),1),o("div",{class:"left-small-rectangle",style:E({visibility:l.seleted?"visible":"hidden"})},[D===3?(r(),u("span",Ve,n(l.label),1)):(r(),u("span",{key:1,class:"left-small-rectangle-text",style:E({color:l.ifPassed===1?"#1BC8A6":l.ifPassed===0?"#FF2300":"",cursor:"pointer"}),onClick:je=>X(D)},n(l.label),13,ke)),Fe,we,D!==0&&D!==1?(r(),u("div",De,n(K(D)),1)):T("",!0),D!==3?(r(),u("span",{key:3,class:N({"do-inspection-normal":l.ifPassed===1,"do-inspection-fault":l.ifPassed===0})},null,2)):T("",!0)],4)]))),128)),(r(!0),u(j,null,x(S.value,l=>(r(),u("div",{key:l.value,class:"center-rectangle-right-side"},[Ae,o("div",Te,n("DI"+l.value),1),o("div",Ee,[o("span",{class:"right-small-rectangle-text",style:E({color:l.diStateValue===void 0?"":l.flag===l.diStateValue?"#1BC8A6":"#FF2300 "})},n(l.label),5),l.detail?(r(),u("span",{key:0,class:"right-small-rectangle-text",style:E({color:l.diStateValue===void 0?"":l.flag===l.diStateValue?"#1BC8A6":"#FF2300 "})},n(l.detail),5)):T("",!0),Oe,Be,o("span",{class:N(l.diStateValue===void 0?"":l.flag===l.diStateValue?"di-inspection-normal":"di-inspection-fault")},null,2)])]))),128))])]),p(ee,{modelValue:C.value,"onUpdate:modelValue":a[8]||(a[8]=l=>C.value=l),width:"30%","align-center":"",draggable:""},{header:c(()=>[o("span",Le,n(g(e)("inspection.manualInspection")+" -- "+A.value),1)]),footer:c(()=>[o("span",Re,[p(f,{color:"#FF2300",onClick:Z},{default:c(()=>[y(n(g(e)("dido.Fail")),1)]),_:1}),p(f,{color:"#1BC8A6",onClick:Y},{default:c(()=>[y(n(g(e)("dido.Pass")),1)]),_:1})])]),default:c(()=>[[4,5].includes(v.value)?(r(),u("div",$e,[p(f,{class:"dialog-btn",type:"info",round:"",plain:"",onClick:a[1]||(a[1]=l=>k("off"))},{default:c(()=>[y(n(g(e)("dido.LightsOff")),1)]),_:1}),p(f,{class:"dialog-btn",type:"info",round:"",plain:"",onClick:a[2]||(a[2]=l=>k("on"))},{default:c(()=>[y(n(g(e)("dido.LightsOn")),1)]),_:1})])):[6,7].includes(v.value)?(r(),u("div",Pe,[p(f,{class:"dialog-btn",type:"info",round:"",plain:"",onClick:a[3]||(a[3]=l=>k("off"))},{default:c(()=>[y(n(g(e)("dido.Stop")),1)]),_:1}),p(f,{class:"dialog-btn",type:"info",round:"",plain:"",onClick:a[4]||(a[4]=l=>k("on"))},{default:c(()=>[y(n(g(e)("dido.Run")),1)]),_:1})])):[0,1].includes(v.value)?(r(),u("div",Me,[p(f,{class:"dialog-btn",type:"info",round:"",plain:"",onClick:a[5]||(a[5]=l=>k("on"))},{default:c(()=>[y(n(g(e)("dido.Tripping")),1)]),_:1})])):[2].includes(v.value)?(r(),u("div",Ie,[p(f,{class:"dialog-btn",type:"info",round:"",plain:"",onClick:a[6]||(a[6]=l=>k("off"))},{default:c(()=>[y(n(g(e)("dido.Closed")),1)]),_:1}),p(f,{class:"dialog-btn",type:"info",round:"",plain:"",onClick:a[7]||(a[7]=l=>k("on"))},{default:c(()=>[y(n(g(e)("dido.Open")),1)]),_:1})])):T("",!0)]),_:1},8,["modelValue"])]),_:1})}}}),He=pe(xe,[["__scopeId","data-v-b2e2b857"]]);export{He as default};
